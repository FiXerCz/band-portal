<%= form_for @band, :html => { :class => "form-horizontal band" } do |f| %>

  <% if @band.errors.any? %>
    <div id="error_expl" class="panel panel-danger">
      <div class="panel-heading">
        <h3 class="panel-title"><%= pluralize(@band.errors.count, "error") %> prohibited this band from being saved:</h3>
      </div>
      <div class="panel-body">
        <ul>
        <% @band.errors.full_messages.each do |msg| %>
          <li><%= msg %></li>
        <% end %>
        </ul>
      </div>
    </div>
  <% end %>

  <div class="form-group">
    <%= f.label :title, :class => 'control-label col-lg-2' %>
    <div class="col-lg-10">
      <%= f.text_field :title, :class => 'form-control' %>
    </div>
    <%=f.error_span(:title) %>
  </div>
  <div class="form-group">
    <%= f.label :description, :class => 'control-label col-lg-2' %>
    <div class="col-lg-10">
      <%= f.text_area :description, :class => 'form-control' %>
    </div>
    <%=f.error_span(:description) %>
  </div>

  <% if action == 'edit' %>
    <div class="form-group">
      <%= f.label :active, :class => 'control-label col-lg-2' %>
      <div class="col-lg-10">
        <%= f.check_box :active, :class => 'form-control' %>
      </div>
      <%=f.error_span(:active) %>
    </div>
  <% else %>
    <%= f.hidden_field(:active,  :value => true) %>
  <% end %>

  <h2>Band members</h2>

  <% if action == 'edit' %>

    <table class="table table-striped">
      <thead>
        <tr>
          <th>Member</th>
          <th>Role in the band</th>
          <th><%=t '.actions', :default => t("helpers.actions") %></th>
        </tr>
      </thead>
      <tbody>

      <%= f.fields_for :band_roles do |r| %>
        <tr>
          <td><%= r.label :role, r.object.user.email, :class => 'control-label col-lg-2' %></td>
          <td><%= r.text_field :role, :class => 'form-control' %><%=r.error_span(:role) %></td>
          <td>
            <% if can? :destroy_member, r.object.band %>
              <%= link_to 'Remove member',
                          '/bands/drop-member/' + r.object.id.to_s,
                          :method => :delete,
                          :data => { :confirm => t('.confirm', :default => t("helpers.links.confirm", :default => 'Are you sure?')) },
                          :class => 'btn btn-default btn-danger' %>
            <% else %>
              <div data-toggle="tooltip" data-placement="left" title="You cannot remove the last member">
                <%= link_to 'Remove member', '#', :class => 'btn btn-default btn-danger disabled' %>
              </div>
            <% end %>
          </td>
        </tr>
      <% end %>

      </tbody>
    </table>

  <% else %>

    <%= f.fields_for :band_roles do |r| %>
      <div class="form-group">
        <%= r.label :role, 'Your role in the band', :class => 'control-label col-lg-2' %>
        <div class="col-lg-10">
          <%= r.text_field :role, :class => 'form-control' %>
          <br />
          <p>You can add more band members later.</p>
        </div>
        <%=r.error_span(:role) %>
      </div>
    <% end %>

  <% end %>

  <div class="form-group">
    <div class="col-lg-offset-2 col-lg-10">
      <%= f.submit nil, :class => 'btn btn-primary' %>
      <%= link_to 'Add new member', '/bands/' + @band.id.to_s + '/add-member', :class => 'btn btn-default' %>
      <%= link_to t('.cancel', :default => t("helpers.links.cancel")),
                bands_path, :class => 'btn btn-default' %>
    </div>
  </div>

<% end %>
